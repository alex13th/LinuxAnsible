---
# tasks file for common

- include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"
    - "{{ default }}.yml"
  tags: 
    - common

- name: Backup repository files
  block:
    - file:
        path: "{{ repository_dir }}/ansible_backup"
        state: directory

    - find:
        paths: "{{ repository_dir }}"
        patterns: "*.repo"
      register: files_to_move

    - copy:
        src: "{{ item.path }}"
        dest: "{{ repository_dir }}/ansible_backup/"
        remote_src: yes
      with_items: "{{ files_to_move.files }}"
      loop_control: 
        label: "Backup repo-file: {{ item.path }}"

    - file:
        path: "{{ item.path }}"
        state: absent
      with_items: "{{ files_to_move.files }}"
      loop_control: 
        label: "Remove repo-file: {{ item.path }}"
  when:
    - use_local_repositories
    - use_only_local_repositories
  tags: 
    - common
    - repository

- name: Import RedHat Tasks
  import_tasks: RedHat.yml
  when: ansible_facts['os_family']|lower == 'redhat'
  tags:
    - common


- include_tasks: firewall_zone.yml
  loop: "{{ zones }}"
  loop_control:
    loop_var: zone
  tags:
    - common
    - firewalld

- name: Reload firewalld
  service:
    name: firewalld
    state: reloaded
  tags:
    - common
    - firewalld
  

- name: Install vim editor
  package:
    pkg: "{{ item }}"
    state: installed
  with_items:
    - vim
  tags: 
    - common